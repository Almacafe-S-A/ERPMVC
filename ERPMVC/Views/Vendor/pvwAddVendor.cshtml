@model ERPMVC.DTO.VendorDTO


@{ Layout = null;
    var messages = new Dictionary<string, string>() { { "custom", "Ingrese un valor correcto." },
{"required","Valor requerido" }
};
    var rules = new Dictionary<string, string>() { { "custom", "customFunction" } };
}

<script>
    var findlistOFAC = 0;
    var FindlistPEPS = 0;
    var FindBlackList = 0;
    var FindLISTONU = 0;


    function customFunction(input) {

        if (input.attr('name') === "VendorId" && input.val() === "0") {
            return false;
        }

        //dropdownlist3.selected

        // Dropchange();

    }
    function FindOfacId() {
        //debugger;
        $('#myModalOFACIdentity').find(':input').not(':submit').val('');
        $('#myModalOFACIdentity').modal('show');
        //  console.log($("#Identidad").val());
        // console.log(JSON.stringify(dataObject));
        // setearvalor("Identidad", identidad);
    }



    //$('#btnprueba').val("");
</script>
@*<div id="NumAccounting">
        @await Html.PartialAsync("pvwAddAccounting", new ERPMVC.DTO.AccountDTO { AccountId = 0 })
    </div>*@
<div id="divPEPSFind">
    @await Html.PartialAsync("~/Views/PEPS/PEPSFind.cshtml")
</div>

<div id="divBlackListFind">
    @await Html.PartialAsync("~/Views/BlackListCustomers/BlackListFind.cshtml")
</div>

<div id="divONULISTFind">
    @await Html.PartialAsync("~/Views/ONU/ONULISTFind.cshtml")
</div>

<div id="divOFACFind">
    @await Html.PartialAsync("~/Views/OFAC/Index.cshtml")
</div>

<div id="divOFACFindIdentity">
    @await Html.PartialAsync("~/Views/OFAC/ListOfacIdentity.cshtml")
</div>


<div id="ModalVendor" class="modal fade" role="dialog">
    <!-- Modal content-->
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title">Datos de Proveedores</h4>
                <button type="button" name="btnprueba" class="close" data-dismiss="modal">&times;</button>

            </div>
            <div class="modal-body">

                <div class="row" id="validation">
                    <div class="col-lg-12">
                        <div class="card">
                            <div class="card-body">
                                <form id="frmVendor" kendo-validator="true" kendo-messages="messages"
                                      data-ajax="true"
                                      data-ajax-method="post"
                                      data-ajax-begin="SaveVendor"
                                      class="validation-wizard wizard-circle">
                                    <div class="form-body">
                                        <h3 class="card-title">Proveedores</h3>
                                        <hr>
                                        <div class="row">
                                            <div class="col-md-4">
                                                <div class="form-group">
                                                    <label asp-for="VendorId" class=" control-label" style="width:100%"></label>
                                                    <input type="text" asp-for="VendorId" name="VendorId" class="form-control" disabled="disabled" style="min-width:100%" />
                                                    <span asp-validation-for="VendorId" class="text-danger"></span>
                                                </div>
                                            </div>
                                            <div class="col-md-4">
                                                <div class="form-group">
                                                    <label asp-for="VendorName" class="control-label" style="width:100%"></label>
                                                    <span>
                                                        <input asp-for="VendorName" data-val-required="Nombre proveedor es requerido" class="form-control form-control-line" onchange="FindVendorByList('VendorName');" style="min-width: 100%" />
                                                        <button type="button" onclick=" ValidarBusqueda(); return PeronIlicitas();" class="k-button k-primary"><i class="fa fa-search"></i>LISTADOS</button>

                                                    </span>
                                                    @*  <span asp-validation-for="VendorName" class="text-danger"></span>
                                                    *@
                                                    <input type="text" id="restsino" hidden class="form-control" style="min-width:85%;" />


                                                    <script>


                                                        var AlertaBusca = $("#restsino").val('0');


                                                        function ValidarBusqueda() {
                                                            if ($("#VendorName").val() == '' && $("#CountryId").val() == 0) {
                                                                alert("LLenar el campo Nombre de Proveedor y seleccione el país para ver el listado")
                                                                return false;
                                                            } else if ($("#SalesOrderName").val() == '') {
                                                                alert("LLenar el campo Nombre de Proveedor para ver el listado")
                                                                return false;
                                                            } else if ($("#CountryId").val() == 0) {
                                                                alert("Seleccione el país para ver el listado")
                                                                return false;
                                                            } else {
                                                                $("#restsino").val('1');
                                                            }
                                                        }



                                                    </script>
                                                </div>
                                            </div>
                                            <div class="col-md-4">
                                                <div class="form-group">
                                                    <label asp-for="RTN" class=" control-label" style="width:100%"></label>
                                                    <input asp-for="RTN" name="RTN" class="form-control" autocomplete="off" style="min-width:100%" data-val-required="RTN es requerido" />
                                                    <span asp-validation-for="RTN" class="text-danger k-invalid-msg" data-for="RTN"></span>


                                                </div>

                                            </div>


                                        </div>
                                        <div class="row">
                                            <div class="col-md-12">
                                                <div class="form-group">
                                                    <label asp-for="VendorTypeId" class="control-label" style="width:100%"></label>
                                                    <kendo-dropdownlist name="VendorTypeId"
                                                                        for="@Model.VendorTypeId"
                                                                        filter="Kendo.Mvc.UI.FilterType.Contains"
                                                                        option-label="Seleccionar Tipo"
                                                                        datatextfield="VendorTypeName"
                                                                        datavaluefield="VendorTypeId"
                                                                        data-val-required="Tipo Proveedor es requerido" style="min-width:100%">
                                                        <datasource type="DataSourceTagHelperType.WebApi" server-operation="true">
                                                            <transport>
                                                                <read url="@Url.Action("GetVendorType", "VendorType")" />
                                                            </transport>
                                                        </datasource>
                                                    </kendo-dropdownlist>


                                                </div>
                                            </div>






                                        </div>
                                        <div class="row">
                                            @*  <div class="col-md-4">
                                                    <div class="form-group">
                                                        <label asp-for="Identidad" class=" control-label" style="width:100%"></label>
                                                        <input type="text" asp-for="Identidad" name="Identidad" class="form-control" autocomplete="off" style="display:block" />
                                                        <button type="button" onclick="return RefreshOFACIdentity();" class="k-button k-primary"><i class="fa fa-search"></i></button>

                                                          <span asp-validation-for="Identidad" class="text-danger"></span>

                                                    </div>
                                                </div>


                                            *@
                                            <div class="col-md-8">
                                                <div class="form-group">
                                                    <label asp-for="Address" class=" control-label" style="width:100%"></label>
                                                    <textarea asp-for="Address" name="Address" class="form-control " data-val-required="Dirección es requerido" style="min-width: 100% !important;"></textarea>
                                                    <span asp-validation-for="Address" class="text-danger"></span>
                                                </div>
                                            </div>
                                            <div class="col-md-4">
                                                <div class="form-group">
                                                    <label asp-for="Estado" class="control-label" style="width:100%"></label>
                                                    <kendo-dropdownlist name="IdEstado"
                                                                        for="@Model.IdEstado"
                                                                        filter="Kendo.Mvc.UI.FilterType.Contains"
                                                                        option-label="Seleccionar Estado"
                                                                        datatextfield="NombreEstado"
                                                                        datavaluefield="IdEstado"
                                                                        data-val-required="El estado es requerido" style="min-width:100%">
                                                        <datasource type="DataSourceTagHelperType.WebApi" server-operation="true">
                                                            <transport>
                                                                <read url="@Url.Action("GetGrupoEstadoUno", "Estados")" />
                                                            </transport>
                                                        </datasource>
                                                    </kendo-dropdownlist>
                                                </div>



                                            </div>





                                        </div>

                                        <div class="row">


                                            <div class="col-md-4">
                                                <script>
                                                    function refreshdepartamento() {
                                                        $("#StateId").data("kendoDropDownList").dataSource.read();
                                                    }
                                                </script>
                                                <div class="form-group">
                                                    <label asp-for="CountryId" class="control-label">País</label>
                                                    <kendo-dropdownlist name="IdCountry"
                                                                        for="@Model.CountryId"
                                                                        filter="Kendo.Mvc.UI.FilterType.Contains"
                                                                        option-label="Seleccionar País"
                                                                        datatextfield="Name"
                                                                        datavaluefield="Id"
                                                                        onchange="refreshdepartamento();"
                                                                        data-val-required="País es requerido" style="width: 100%;">
                                                        <datasource type="DataSourceTagHelperType.WebApi" server-operation="true">
                                                            <transport>
                                                                <read url="@Url.Action("Get", "Country")" />
                                                            </transport>
                                                        </datasource>
                                                    </kendo-dropdownlist>
                                                </div>
                                            </div>

                                            <div class="col-md-4">
                                                <script>
                                                    function GetCountryId() {

                                                        return { 'CountryId': $("#CountryId").val() }
                                                    }

                                                    function refreshmunicipio() {
                                                        $("#CityId").data("kendoDropDownList").dataSource.read();
                                                    }
                                                </script>
                                                <div class="form-group">
                                                    <label asp-for="StateId" class="control-label">Departamento</label>
                                                    <kendo-dropdownlist name="StateId"
                                                                        for="@Model.StateId"
                                                                        filter="Kendo.Mvc.UI.FilterType.Contains"
                                                                        option-label="Seleccionar Departamento"
                                                                        datatextfield="Name"
                                                                        datavaluefield="Id"
                                                                        onchange="refreshmunicipio();"
                                                                        data-val-required="Departamento es requerido" style="width: 100%;">
                                                        <datasource type="DataSourceTagHelperType.WebApi" server-operation="true">
                                                            <transport>
                                                                <read url="@Url.Action("GetJson", "State")" data="GetCountryId" />
                                                            </transport>
                                                        </datasource>
                                                    </kendo-dropdownlist>
                                                </div>
                                            </div>


                                            <div class="col-md-4">
                                                <script>
                                                    function GetCityId() {

                                                        return { 'StateId': $("#StateId").val() }
                                                    }
                                                </script>
                                                <div class="form-group">
                                                    <label asp-for="CityId" class="control-label">Ciudad</label>
                                                    <kendo-dropdownlist name="IdCity"
                                                                        for="@Model.CityId"
                                                                        filter="Kendo.Mvc.UI.FilterType.Contains"
                                                                        option-label="Seleccionar Ciudad"
                                                                        datatextfield="Name"
                                                                        datavaluefield="Id"
                                                                        data-val-required="Ciudad es requerido" style="width: 100%;">
                                                        <datasource type="DataSourceTagHelperType.WebApi" server-operation="true">
                                                            <transport>
                                                                <read url="@Url.Action("GetCityJson", "City")" data="GetCityId" />
                                                            </transport>
                                                        </datasource>
                                                    </kendo-dropdownlist>
                                                </div>
                                            </div>





                                        </div>


                                        <div class="row">
                                            <div class="col-md-4">
                                                <div class="form-group">
                                                    <label asp-for="CurrencyId" class=" control-label" style="width:100%">Moneda</label>

                                                    <kendo-dropdownlist name="CurrencyId"
                                                                        for="@Model.CurrencyId"
                                                                        filter="Kendo.Mvc.UI.FilterType.Contains"
                                                                        option-label="Seleccionar Moneda    "
                                                                        style="min-width:100%"
                                                                        datatextfield="CurrencyName"
                                                                        datavaluefield="CurrencyId"
                                                                        data-val-required="Moneda es requerido">
                                                        <datasource type="DataSourceTagHelperType.WebApi" server-operation="true">
                                                            <transport>
                                                                <read url="@Url.Action("Get", "Currency")" />
                                                            </transport>
                                                        </datasource>
                                                    </kendo-dropdownlist>
                                                    <span asp-validation-for="CurrencyId" class="text-danger"></span>


                                                </div>
                                            </div>
                                            <div class="col-md-4">

                                                <div class="form-group">
                                                    <label asp-for="Phone" class=" control-label" style="width:100%"></label>
                                                    <input type="text" asp-for="Phone" name="Phone" class="form-control" style="min-width:100%" data-val-required="Teléfono es requerido" onkeypress="return SoloNumeros(event)" />

                                                    <span asp-validation-for="Phone" class="text-danger"></span>
                                                </div>
                                            </div>



                                            @*
                                                <div class="col-md-4">
                                                    <div class="form-group">
                                                        <label asp-for="QtyMin" class=" control-label" style="width:100%"></label>
                                                        <kendo-numerictextbox name="QtyMin"
                                                                              format="n2" spinners="false"
                                                                              min="0"
                                                                              required class="control-label right bold"
                                                                              style="width: 100%;text-align:right;padding-right: 3px"
                                                                              max="999999999"
                                                                              disabled="disabled"
                                                                              step="1"
                                                                              value="Model.QtyMin"></kendo-numerictextbox>
                                                        <span asp-validation-for="QtyMin" class="text-danger"></span>

                                                    </div>
                                                </div>
                                            *@
                                        </div>
                                        <div class="row">

                                            <div class="col-md-4">

                                                <div class="form-group">
                                                    <script>
                                                        function GetCategoriaProveedor() {
                                                            return { 'Id': 24 }
                                                        }
                                                    </script>
                                                    <label asp-for="IdEstadoVendorConfi" class="control-label" style="width:100%"></label>
                                                    <kendo-dropdownlist name="IdEstadoVendorConfi" filter="Kendo.Mvc.UI.FilterType.Contains"
                                                                        option-label="Seleccion la Categoria"
                                                                        for="@Model.IdEstadoVendorConfi"
                                                                        datatextfield="Nombre"
                                                                        datavaluefield="Id"
                                                                        auto-bind="true"
                                                                        data-val-required="Categoria proveedor es requerido"
                                                                        onchange="Dropchange();"
                                                                        style="width: 100%;">
                                                        <datasource type="DataSourceTagHelperType.WebApi" server-filtering="true">
                                                            <transport>
                                                                <read url="@Url.Action("GetElementoByIdConfiguracion", "ElementoConfiguracion")" data="GetCategoriaProveedor" />
                                                            </transport>
                                                        </datasource>

                                                    </kendo-dropdownlist>
                                                    <span asp-validation-for="IdEstadoVendorConfi" class="text-danger"></span>

                                                    @*   <label asp-for="IdEstadoVendorConfi" class="control-label" style="width:100%"></label>
                                                        <kendo-dropdownlist name="IdEstadoVendorConfi"
                                                                            for="@Model.IdEstadoVendorConfi"
                                                                            filter="Kendo.Mvc.UI.FilterType.Contains"
                                                                            option-label="Seleccionar Estado"
                                                                            datatextfield="NombreEstado"
                                                                            datavaluefield="IdEstado"
                                                                            style="min-width:100%"
                                                                            require
                                                                            onchange="Dropchange();">
                                                            <datasource type="DataSourceTagHelperType.WebApi" server-operation="true">
                                                                <transport>
                                                                    <read url="@Url.Action("GetGrupoEstadoUno", "Estados")" />
                                                                </transport>
                                                            </datasource>
                                                        </kendo-dropdownlist>

                                                    *@
                                                </div>
                                            </div>
                                            <div class="col-md-4">
                                                <div class="form-group">
                                                    <label asp-for="QtyMonth" class=" control-label" style="width:100%"></label>
                                                    @* format="  #.00 " step="1"*@
                                                    <kendo-numerictextbox name="QtyMonth"
                                                                          format="n2"
                                                                          min="0"
                                                                          data-val-required="Limite Mensual es requerido"
                                                                          class="control-label right bold"
                                                                          style="min-width: 100%;text-align:right;padding-right: 3px"
                                                                          max="999999999"
                                                                          step="1"
                                                                          disabled="disabled"
                                                                          value="Model.QtyMonth"></kendo-numerictextbox>
                                                    <span asp-validation-for="QtyMonth" class="text-danger"></span>

                                                </div>
                                            </div>



                                        </div>


                                        <div id="myDivCategoriaMayor" style="display:none">
                                            <div class="row">
                                                <div class="col-md-4">
                                                    <div class="form-group">
                                                        <label asp-for="CompanyReferenceone" class=" control-label" style="width:100%"></label>
                                                        <input type="text" asp-for="CompanyReferenceone" name="CompanyReferenceone" class="form-control" style="min-width:100%" />
                                                        @*  <span asp-validation-for="CompanyReferenceone" class="text-danger"></span>
                                                        *@
                                                    </div>
                                                </div>

                                                <div class="col-md-4">
                                                    <div class="form-group">
                                                        <label asp-for="CompanyReferencetwo" class=" control-label" style="width:100%"></label>
                                                        <input type="text" asp-for="CompanyReferencetwo" name="CompanyReferencetwo" class="form-control" style="min-width:100%" />
                                                        @*     <span asp-validation-for="CompanyReferencetwo" class="text-danger"></span>
                                                        *@
                                                    </div>
                                                </div>


                                            </div>
                                            <div class="row">
                                                <div class="col-md-4">
                                                    <div class="form-group">
                                                        <label asp-for="RepresentativeName" class="control-label" style="width:100%"></label>

                                                        <input asp-for="RepresentativeName" class="form-control form-control-line" onchange="RefreshOFAC('RepresentativeName');" style="min-width: 100%" />
                                                        <button type="button" onclick="return RefreshOFAC('RepresentativeName');" class="k-button k-primary"><i class="fa fa-search"></i>LISTADOS</button>



                                                    </div>
                                                </div>
                                                <div class="col-md-4">
                                                    <div class="form-group">
                                                        <label asp-for="IdentityRepresentative" class=" control-label" style="width:100%"></label>
                                                        <input type="text" asp-for="IdentityRepresentative" name="IdentityRepresentative" class="form-control" style="min-width:100%" onkeypress="return SoloNumeros(event)" />
                                                    </div>
                                                </div>

                                                <div class="col-md-4">
                                                    <div class="form-group">
                                                        <label asp-for="RTNRepresentative" class=" control-label" style="width:100%"></label>
                                                        <input asp-for="RTNRepresentative" name="RTNRepresentative" class="form-control" autocomplete="off" style="min-width:100%" onkeypress="return SoloNumeros(event)" />


                                                    </div>

                                                </div>


                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-12">
                                                <button id="btnVendor" class="form-control btn-miboton" type="submit"> Guardar </button>
                                            </div>
                                        </div>



                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


<script>
    $("#RTN").on("change", function () {
        var RTN1 = $("#RTN").val();
        if (RTN1 != "") {
            debugger;
            var dataObjectConfiguration = {
                RTN: RTN1
            };
               $.ajax({
                                url: '@Url.Action("GetVendorByRTN", "Vendor")',
                                method: 'POST',
                                datatype: "json",
                                contentType: 'application/json',
                                async: false,
                                data: JSON.stringify(dataObjectConfiguration),
                                success: function (result) {
                                    if (result.VendorId != 0) {
                                        $("#RTN").val('');
                                    $.toast({
                                        heading: 'Error',
                                        text: '<br/><br/>' + ' El RTN ingresado ya existe en otro proveedor.',
                                        position: 'top-right',
                                        showHideTransition: 'fade',
                                        loaderBg: '#ff6849',
                                        icon: 'error',
                                        hideAfter: 30000,
                                        stack: 6
                                    });
                                    }
                                },
                                error: function (XMLHttpRequest, textStatus, errorThrown) {
                                    notification.show({
                                        title: "Validación",
                                        message: textStatus + ": " + XMLHttpRequest.responseText
                                    }, "error");

                                }
             });
        }
    });




    
    $('document').ready(function () {
        var limitmonth;
        debugger;

        var dataObjectConfiguration = {};
        $.ajax({
                                url: '@Url.Action("GetConfigurationVendorActive", "ConfigurationVendor")',
                                method: 'GET',
                                datatype: "json",
                                contentType: 'application/json',
                                async: false,
                                data: dataObjectConfiguration,
                                success: function (result) {

                                    //notification.show({
                                    //    message: "Guardado correctamente!"
                                    //}, "upload-success");
                                   // console.log(result);
                                    limitmonth = result;
                                    console.log("El valor de mensual " + limitmonth);
                                    $("#QtyMonth").val(limitmonth);

                                },
                                error: function (XMLHttpRequest, textStatus, errorThrown) {

                                    notification.show({
                                        title: "Validación",
                                        message: textStatus + ": " + XMLHttpRequest.responseText
                                    }, "error");

                                }
                            });

        if ($("#QtyMonth").val() > limitmonth) {
            document.getElementById('myDivCategoriaMayor').style.display = 'block';

            //  $('#card').children().attr('readonly', true);
            //$("#tabDetalleProveedor").disabled = false;
            // setearvalor("QtyMonth", $("#QtyMonth").val());
            //console.log("Prueba para verificar");
        }
        else {
            document.getElementById('myDivCategoriaMayor').style.display = 'none';


        }

    });
    function SoloNumeros(e) {
        key = e.keyCode || e.which;
        tecla = String.fromCharCode(key).toLowerCase();
        letras = "1234567890-";
        especiales = "8-37-39-46";



        tecla_especial = false
        for (var i in especiales) {
            if (key == especiales[i]) {
                tecla_especial = true;
                break;
            }
        }



        if (letras.indexOf(tecla) == -1 && !tecla_especial) {
            return false;
        }
    }
    function setearvalor(nombrenumerico, valor) {
        var numeric = $("#" + nombrenumerico).data("kendoNumericTextBox");
        numeric.value(valor);
        numeric.trigger('change');
        numeric = null;
    }

    function Dropchange() {
        //debugger;
        var mensual;
        var dataObjectConfiguration = {};
        $.ajax({
                                url: '@Url.Action("GetConfigurationVendorActive", "ConfigurationVendor")',
                                method: 'GET',
                                datatype: "json",
                                contentType: 'application/json',
                                async: false,
                                data: dataObjectConfiguration,
                                success: function (result) {

                                    //notification.show({
                                    //    message: "Guardado correctamente!"
                                    //}, "upload-success");
                                    if (result == null)
                                    {
                                        $.toast({
                                            heading: 'Error',
                                            text:  ' No hay configuracion de Proveedores Activa.',
                                            position: 'top-right',
                                            showHideTransition: 'fade',
                                            loaderBg: '#ff6849',
                                            icon: 'error',
                                            hideAfter: 30000,
                                            stack: 6
                                        });
                                    }
                                    else {
                                    console.log("Este es el valor de result");
                                    console.log(result);
                                    mensual = result;
                                        console.log(mensual);
                                        $("#QtyMonth").val(result);
                                    }
                                },
                                error: function (XMLHttpRequest, textStatus, errorThrown) {

                                    notification.show({
                                        title: "Validación",
                                        message: textStatus + ": " + XMLHttpRequest.responseText
                                    }, "error");

                                }
                            });

        if ($("#IdEstadoVendorConfi").data("kendoDropDownList").text() === "Menor") {
          //  document.getElementById('LabelQtyMonth').innerHTML = "Menor";
              setearvalor("QtyMonth", mensual);
            document.getElementById('myDivCategoriaMayor').style.display = 'none';

          }
        else {
          //  document.getElementById('LabelQtyMonth').innerHTML = "Mayor";

            var mensual = mensual + 0.01;

            setearvalor("QtyMonth", mensual);
            document.getElementById('myDivCategoriaMayor').style.display = 'block';

          }
        };


            function RefrescarGrid() {
                debugger;
                var grid = $("#gridNumeracionVendor").getKendoGrid();
                grid.dataSource.read();
            }
    function SaveVendor(e) {

                    var notification = $("#notification").data("kendoNotification");
                   // e.preventDefault();
                debugger;
                $("#btnVendor").hide();
                $("#btnVendor").prop("disabled", true);
                RefreshOFAC();
                var validadetalle = true;

                var displayedData = $("#gridNumeracionVendor").data().kendoGrid.dataSource.view();
                var listadoenqueaparece = "";
                var gridListaOFAC = $("#gridListaOFAC").data().kendoGrid.dataSource.data();
                var gridListaPEPS = $("#gridListaPEPS").data().kendoGrid.dataSource.data();
                var gridListaNegra = $("#gridListaNegra").data().kendoGrid.dataSource.data();
                var gridListaONU = $("#gridListaONU").data().kendoGrid.dataSource.data();
                var gridListaOFACIdentity = $("#gridListaOFACIdentity").getKendoGrid().dataSource.read();

               // debugger;
                var confirmaexpecion = false;

                if (
                    gridListaPEPS.length > 0

                )
                {
                    if (confirm("¿Desea crear una excepción para este Proveedor y enviar a aprobación?, esto notificara a Gerencia")) {
                        validadetalle = true;
                        confirmaexpecion = true;
                        Estado = 'Enviada a Aprobacion'
                        listadoenqueaparece += gridListaPEPS.length > 0 ? "PEPS" : "";
                    }
                   /* else {
                        validadetalle = false;
                        notification.show(
                        {
                            title: "Validación",
                            message: "No puede guardar este para este Proveedor ya que aparece en los listados!"
                        }, "error");
                    }*/

                }
                /*else if (gridListaOFAC.length > 0
                    || gridListaNegra.length > 0
                    || gridListaONU.length > 0
                    ||  gridListaOFACIdentity >0
                                )
                      {
                            listadoenqueaparece += gridListaOFAC.length > 0 ? "OFAC" : "";
                            listadoenqueaparece += gridListaNegra.length > 0 ? "ListaNegra" : "";
                            listadoenqueaparece += gridListaONU.length > 0 ? "ListadoONU" : "";
                            listadoenqueaparece += gridListaOFACIdentity.length > 0 ? "OFAC IDENTITY" : "";


                            validadetalle = true;
                            // $("#btnVendor").prop("disabled", false);

                            notification.show({
                                title: "Validación",
                                message: "Esta Proveedor se muestra como estado rechazado!"
                            }, "error");

                }*/
        if (validadetalle)
        {
            debugger;
            var bandera = validarllenado();
            if ( bandera== true)
            {
                //$("#Identidad").val() = ;
                    var dataObject = {
                        'VendorId': $("#VendorId").val(),
                        'VendorName': $("#VendorName").val(),
                        'VendorTypeId': $("#VendorTypeId").val(),
                        'VendorTypeName': $("#VendorTypeId").data("kendoDropDownList").text(),
                        'RTN': $("#RTN").val(),
                        'CityId': $("#CityId").val(),
                        'Address': $("#Address").val(),
                        'StateId': $("#StateId").val(),
                        'CountryId': $("#CountryId").val(),
                        'IdEstadoVendorConfi': $("#IdEstadoVendorConfi").val(),
                        'EstadoVendorConfi': $("#IdEstadoVendorConfi").data("kendoDropDownList").text(),
                        'Phone': $("#Phone").val(),
                        //'Identidad': $("#Identidad").val('0'),
                        'Email': $("#Email").val(),
                        'CurrencyId': $("#CurrencyId").val(),
                        'IdEstado': $("#IdEstado").val(),
                        'Estado': $("#IdEstado").data("kendoDropDownList").text(),
                        'CompanyReferenceone': $("#CompanyReferenceone").val(),
                        'CompanyReferencetwo': $("#CompanyReferencetwo").val(),
                        'QtyMonth': $("#QtyMonth").val(),
                        'CreatedDate': $("#CreatedDate").val(),
                        'ModifiedDate': $("#ModifiedDate").val(),
                        'CreatedUser': $("#CreatedUser").val(),
                        'ModifiedUser': $("#ModifiedUser").val(),
                        'RepresentativeName': $("#RepresentativeName").val(),
                        'IdentityRepresentative': $("#IdentityRepresentative").val(),
                        'RTNRepresentative': $("#RTNRepresentative").val(),

                        '_Vendor': displayedData
                    };

                   // console.log(JSON.stringify(dataObject));
                    //var form = $("#frmNumeracion");
                   // form.validate();
                    var validator = $("#frmVendor").data("kendoValidator");
                    var status = $(".status");
                    if (validator.validate()) {

                            $.ajax({
                                url: '@Url.Action("SaveVendor", "Vendor")',
                                method: 'POST',
                                datatype: "json",
                                contentType: 'application/json',
                                async: false,
                                data: JSON.stringify(dataObject),
                                success: function (data) {

                                    //notification.show({
                                    //    message: "Guardado correctamente!"
                                    //}, "upload-success");
                                    $.toast({
                                        heading: 'Satisfactorio',
                                        text: '<br/><br/> Datos guardados correctamente.',
                                        position: 'top-right',
                                        loaderBg: '#ff6849',
                                        icon: 'success',
                                        hideAfter: 30000,
                                        stack: 6
                                    });

                                    RefrescarGrid();

                                    $('#ModalVendor').modal('hide');


                                },
                                error: function (XMLHttpRequest, textStatus, errorThrown) {

                                    notification.show({
                                        title: "Validación",
                                        message: textStatus + ": " + XMLHttpRequest.responseText
                                    }, "error");

                                }
                            });

                        }
                    else {
                        $("#btnVendor").show();
                        $("#btnVendor").prop("disabled", false);
                            status.text("Oops! Hay datos invalidos en el formulario.")
                                .removeClass("valid")
                                .addClass("invalid");
                        }



               // } else
               // {
                 //
            }
            else{
                $.toast({
                    heading: 'Error',
                    text: '<br/><br/>' + ' Los campos de Categoria de Proveedor no pueden quedar vacios.',
                    position: 'top-right',
                    showHideTransition: 'fade',
                    loaderBg: '#ff6849',
                    icon: 'error',
                    hideAfter: 30000,
                    stack: 6
                });
            }

        }
        $("#btnVendor").show();
       $("#btnVendor").prop("disabled", false);
    }
    function validarllenado() {
        if   (   ($("#QtyMonth").val() > limitmonth)
            && ($("#CompanyReferenceone").val() == '' || $("#CompanyReferenceone").val() == null)
            && ($("#CompanyReferencetwo").val() == '' || $("#CompanyReferencetwo").val() == null)
            && ($("#RepresentativeName").val() == '' || $("#RepresentativeName").val() == null)
            && ($("#IdentityRepresentative").val() == '' || $("#IdentityRepresentative").val() == null)
            && ($("#RTNRepresentative").val() == '' || $("#RTNRepresentative").val() == null)
           )
         {
             return false;
        } else {
            //alert("Seleccionaste: todos llenoss");

            //alert("Faltan por llenar campos");

            return true;
        }
    }
    function FindVendorByList(nombre) {
        console.log(nombre)
        PeronIlicitas(nombre);
        //  $("#btnVendor").prop("disabled", false);

    }
</script>

<script>
    //Buscar en las listas

        function DataONUListilicitas(nombre) {


        debugger;
            var mfirstname = $("#VendorName").val();
            var mlastName = $("#VendorName").val();
            var thirtname = $("#VendorName").val();


        return {
            FIRST_NAME: mfirstname,
        SECOND_NAME: mlastName,
        THIRD_NAME: thirtname,
    };

    }


    function DataPEPSlist(nombre) {

        debugger;
        var mfirstname = $("#VendorName").val();


        return {
            Funcionario: mfirstname,
        };

    }


    function DataBlackListilicitas(nombre) {
        var mfirstname = $("#VendorName").val();



        return {
            CustomerName: mfirstname,

        };

    }

    function DataOFAClist(nombre) {
        debugger;
        var mfirstname = $("#VendorName").val();
        var mlastName = $("#VendorName").val();


        return {
            firstName: mfirstname,
            lastName: mlastName
        };

    }


    function PeronIlicitas(nombre) {
        debugger;
        if ($("#CountryId").val() != 0) {

            var generar_alertas = false;

            $.ajax({
                url: '@Url.Action("GetBlackListByParams", "BlackListCustomers")',
                method: 'GET',
                datatype: "json",
                contentType: 'application/json',
                async: false,
                data: DataBlackListilicitas(nombre),
                success: function (GetBlackListByParams) {

                    var gridListaNegra = $("#gridListaNegra").getKendoGrid();
                    var datasource = gridListaNegra.dataSource;

                    var raw = datasource._data;
                    for (i = datasource._data.length - 1; i >= 0; i--) {
                        var item = raw[i];
                        datasource.remove(item);
                    }

                    for (var i = 0; i < GetBlackListByParams.Data.length; i++) {
                        datasource.insert(GetBlackListByParams.Data[i]);
                    }

                    var gridListalengthNegra = $("#gridListaNegra").data().kendoGrid.dataSource.data();

                    if (gridListalengthNegra.length > 0) {
                        $("#myModalListaNegra").modal('show');

                        generar_alertas = true;
                    }
                    else {
                        $("#myModalListaNegra").modal('hide');

                        if (AlertaBusca.val() == '1') {
                            $.toast({
                                heading: 'En la Busqueda',
                                text: '<br/><br/> No se encuentran resultados en la Lista Negra.',
                                position: 'top-right',
                                loaderBg: '#ff6849',
                                icon: 'success',
                                showHideTransition: 'slide',
                                hideAfter: 6000,
                                stack: 6
                            });
                        }


                    }

                },
                error: function (XMLHttpRequest, textStatus, errorThrown) {

                    $.toast({
                        heading: 'Validación',
                        text: textStatus + ": " + XMLHttpRequest.responseText,
                        position: 'top-right',
                        loaderBg: '#ff6849',
                        icon: 'error',
                        hideAfter: 30000,
                        stack: 6
                    });

                }
            });


            $.ajax({
                url: '@Url.Action("GetPersonByName", "OFAC")',
                method: 'GET',
                datatype: "json",
                contentType: 'application/json',
                async: false,
                data: DataOFAClist(nombre),
                success: function (data) {

                    var grid = $("#gridListaOFAC").getKendoGrid();
                    var datasource = grid.dataSource;
                    var raw = datasource._data;
                    for (i = datasource._data.length - 1; i >= 0; i--) {
                        var item = raw[i];
                        datasource.remove(item);
                    }

                    for (var i = 0; i < data.Data.length; i++) {
                        datasource.insert(data.Data[i]);
                        generar_alertas = true;
                    }

                    var gridListaOFAClen = $("#gridListaOFAC").data().kendoGrid.dataSource.data();

                    if (gridListaOFAClen.length > 0) {
                        $("#myModalOFAC").modal('show');
                    }
                    else {
                        $("#myModalOFAC").modal('hide');


                        if (AlertaBusca.val() == '1') {
                            $.toast({
                                heading: 'En la Busqueda',
                                text: '<br/><br/> No se encuentran resultados en OFAC.',
                                position: 'top-right',
                                loaderBg: '#ff6849',
                                icon: 'success',
                                showHideTransition: 'slide',
                                hideAfter: 6000,
                                stack: 6
                            });
                        }
                    }


                },
                error: function (XMLHttpRequest, textStatus, errorThrown) {

                    $.toast({
                        heading: 'Validación',
                        text: textStatus + ": " + XMLHttpRequest.responseText,
                        position: 'top-right',
                        loaderBg: '#ff6849',
                        icon: 'error',
                        hideAfter: 30000,
                        stack: 6
                    });

                }
            });


            $.ajax({
                url: '@Url.Action("GetByParams", "PEPS")',
                method: 'GET',
                datatype: "json",
                contentType: 'application/json',
                async: false,
                data: DataPEPSlist(nombre),
                success: function (data) {


                    var gridListaPEPS = $("#gridListaPEPS").getKendoGrid();
                    var datasource = gridListaPEPS.dataSource;

                    var raw = datasource._data;
                    for (i = datasource._data.length - 1; i >= 0; i--) {
                        var item = raw[i];
                        datasource.remove(item);
                    }

                    for (var i = 0; i < data.Data.length; i++) {
                        datasource.insert(data.Data[i]);
                    }

                    var gridListalengthpeps = $("#gridListaPEPS").data().kendoGrid.dataSource.data();


                    if (gridListalengthpeps.length > 0) {
                        $("#myModalPEPS").modal('show');
                        generar_alertas = true;
                    }
                    else {
                        $("#myModalPEPS").modal('hide');
                        if (AlertaBusca.val() == '1') {
                            $.toast({
                                heading: 'En la Busqueda',
                                text: '<br/><br/> No se encuentran resultados en PEPS.',
                                position: 'top-right',
                                loaderBg: '#ff6849',
                                icon: 'success',
                                showHideTransition: 'slide',
                                hideAfter: 6000,
                                stack: 6
                            });
                        }

                    }

                },
                error: function (XMLHttpRequest, textStatus, errorThrown) {

                    $.toast({
                        heading: 'Validación',
                        text: textStatus + ": " + XMLHttpRequest.responseText,
                        position: 'top-right',
                        loaderBg: '#ff6849',
                        icon: 'error',
                        hideAfter: 30000,
                        stack: 6
                    });

                }
            });

            $.ajax({
                url: '@Url.Action("GetONUPersonByName", "ONU")',
                method: 'GET',
                datatype: "json",
                contentType: 'application/json',
                async: false,
                data: DataONUListilicitas(nombre),
                success: function (data) {

                    var gridListaONU = $("#gridListaONU").getKendoGrid();
                    var datasource = gridListaONU.dataSource;

                    var raw = datasource._data;
                    for (i = datasource._data.length - 1; i >= 0; i--) {
                        var item = raw[i];
                        datasource.remove(item);
                    }

                    for (var i = 0; i < data.Data.length; i++) {
                        datasource.insert(data.Data[i]);
                    }


                    var gridListalengthONU = $("#gridListaONU").data().kendoGrid.dataSource.data();

                    if (gridListalengthONU.length > 0) {
                        $("#myModalListaONU").modal('show');
                        generar_alertas = true;
                    }
                    else {
                        $("#myModalListaONU").modal('hide');

                        if (AlertaBusca.val() == '1') {
                            $.toast({
                                heading: 'En la Busqueda',
                                text: '<br/><br/> No se encuentran resultados en ONU.',
                                position: 'top-right',
                                loaderBg: '#ff6849',
                                icon: 'success',
                                showHideTransition: 'slide',
                                hideAfter: 6000,
                                stack: 6
                            });
                        }


                    }

                },
                error: function (XMLHttpRequest, textStatus, errorThrown) {

                    $.toast({
                        heading: 'Validación',
                        text: textStatus + ": " + XMLHttpRequest.responseText,
                        position: 'top-right',
                        loaderBg: '#ff6849',
                        icon: 'error',
                        hideAfter: 30000,
                        stack: 6
                    });

                }
            });



            if (generar_alertas == true && AlertaBusca.val() == '1') {

                var dataAlerta = {

                    'DocumentId': 1,
                    'DocumentName': 'PROVEEDOR',

                    'CloseDate': '0001-01-01',

                };

                $.ajax({
                    url: '@Url.Action("GenerarAlerta", "Alert")',
                    method: 'POST',
                    datatype: "json",
                    contentType: "application/json",
                    async: false,
                    data: JSON.stringify(dataAlerta),
                    success: function (data) {

                    },
                    error: function (XMLHttpRequest, textStatus, errorThrown) {

                        $.toast({
                            heading: 'Validación',
                            text: textStatus + ": " + XMLHttpRequest.responseText,
                            position: 'top-right',
                            loaderBg: '#ff6849',
                            icon: 'error',
                            hideAfter: 30000,
                            stack: 6
                        });

                    }
                });



            }
            var generar_alertasPaisGAFI = false;
            var Pais = $("#CountryId").data("kendoDropDownList").text();
            dataCountry = {
                'Name' : Pais,
            }

            $.ajax({
                    url: '@Url.Action("PaisesGAFIByName", "Country")',
                    method: 'POST',
                    datatype: "json",
                    contentType: "application/json",
                    async: false,
                    data: JSON.stringify(dataCountry),
                    success: function (data) {
                        if (data != undefined) {
                            generar_alertasPaisGAFI = true;
                        }
                        else {
                            generar_alertasPaisGAFI = false;
                        }
                    },
                    error: function (XMLHttpRequest, textStatus, errorThrown) {

                        $.toast({
                            heading: 'Validación',
                            text: textStatus + ": " + XMLHttpRequest.responseText,
                            position: 'top-right',
                            loaderBg: '#ff6849',
                            icon: 'error',
                            hideAfter: 30000,
                            stack: 6
                        });

                    }
                });

            if (generar_alertasPaisGAFI == true) {
                var VendorName = $("#VendorName").val();
                var dataAlertaPaisGAFI = {

                    'DocumentId': 1,
                    'DocumentName': 'PROVEEDOR',
                    'AlertName': 'País GAFI',
                    'Description': "El país seleccionado para el proveedor: " + VendorName + ", esta dentro del listado de paises GAFI",
                    'CloseDate': '0001-01-01',

                };

                $.ajax({
                    url: '@Url.Action("GenerarAlerta", "Alert")',
                    method: 'POST',
                    datatype: "json",
                    contentType: "application/json",
                    async: false,
                    data: JSON.stringify(dataAlertaPaisGAFI),
                    success: function (data) {

                    },
                    error: function (XMLHttpRequest, textStatus, errorThrown) {

                        $.toast({
                            heading: 'Validación',
                            text: textStatus + ": " + XMLHttpRequest.responseText,
                            position: 'top-right',
                            loaderBg: '#ff6849',
                            icon: 'error',
                            hideAfter: 30000,
                            stack: 6
                        });

                    }
                });
            }
        }
    }







</script>


